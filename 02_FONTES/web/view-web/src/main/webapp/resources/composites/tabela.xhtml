<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:composite="http://java.sun.com/jsf/composite"
      xmlns:custom="http://sefaz.to.gov.br/composites"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">

    <composite:interface>
        <composite:attribute name="id"/>
    	<composite:attribute name="title"/>
        <composite:attribute name="headers"/>
        <composite:attribute name="bean" required="true" />
        <composite:attribute name="fields" required="true" />
        <composite:attribute name="select"/>
        <composite:attribute name="selectTarget"/>
        <composite:attribute name="delete"/>
        <composite:attribute name="paginable" default="true"/>
    </composite:interface>

    <composite:implementation>
        <div id="#{cc.attrs.containerId}" class="panel panel-default">
            <f:metadata>
                <c:choose>
                    <c:when test="#{cc.attrs.paginable eq 'true'}">
                        <f:event type="preRenderView" listener="#{cc.attrs.bean.loadPage(cc.attrs.bean.pageNumber)}"/>
                    </c:when>
                    <c:otherwise>
                        <f:event type="preRenderView" listener="#{cc.attrs.bean.loadList()}"/>
                    </c:otherwise>
                </c:choose>
            </f:metadata>
            <c:if test="#{not empty cc.attrs.title}">
                <div class="panel-heading"><h3 class="panel-title">#{cc.attrs.title}</h3></div>
            </c:if>
            <h:form styleClass="form-inline panel-body">
                <div>
                    <table class="table">
                        <thead>
                            <tr>
                                <c:forEach var="header" items="#{cc.attrs.headers.split(',')}">
                                    <th>#{header.trim()}</th>
                                </c:forEach>
                                <c:if test="#{not empty cc.attrs.select or not empty cc.attrs.delete}">
                                    <th class="text-center"></th>
                                </c:if>
                            </tr>
                        </thead>
                        <tbody>
                            <ui:repeat value="#{cc.attrs.bean.list}" var="registro">
                                <tr>
                                    <c:forEach var="coluna" items="#{cc.attrs.fields.split(',')}">
                                        <c:choose>
                                            <c:when test="#{fn:indexOf(coluna,'.') eq -1}">
                                                <td>#{registro[coluna]}</td>
                                            </c:when>
                                            <c:otherwise>
                                                <td>#{registro[fn:substringBefore(coluna, ".")][fn:substringAfter(coluna, ".")]}</td>
                                            </c:otherwise>
                                        </c:choose>
                                    </c:forEach>

                                    <c:if test="#{not empty cc.attrs.select or not empty cc.attrs.delete}">
                                        <td class="text-center">
                                        <c:if test="#{not empty cc.attrs.select}">
                                            <h:panelGroup>
                                                <f:ajax
                                                        listener="#{cc.attrs.bean.select(registro[cc.attrs.select])}"
                                                        event="click" render="#{cc.attrs.selectTarget}"/>
                                                <input type="radio" name="selectTabelaRadio" value="#{registro[cc.attrs.select]}"/>
                                            </h:panelGroup>
                                        </c:if>
                                            <c:if test="#{not empty cc.attrs.delete}">
                                                <h:commandLink onclick="$('#confirmmodal_#{registro[cc.attrs.delete]}').modal();return false;">
                                                    <i class="glyphicon glyphicon-trash" />
                                                </h:commandLink>

                                                <custom:confirmmodal modalId="confirmmodal_#{registro[cc.attrs.delete]}"
                                                                     metodo="#{cc.attrs.bean.delete(registro[cc.attrs.delete])}"
                                                                     mensagem="Deseja realizar a exclusÃ£o do banco?"
                                                                     renderTarget="#{cc.attrs.containerId}" />

                                            </c:if>
                                        </td>
                                    </c:if>
                                </tr>
                            </ui:repeat>
                        </tbody>
                    </table>
                </div>
                <c:if test="#{cc.attrs.paginable eq 'true'}">
                    <custom:pagination bean="#{cc.attrs.bean}"
                                       renderTarget="#{cc.attrs.containerId}" />
                </c:if>

            </h:form>
        </div>
    </composite:implementation>

</html>